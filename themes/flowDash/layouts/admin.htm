description = "Admin layout"

[localePicker]
forceUrl = 1

[staticMenu mainMenu]
code = "main-menu"

[staticBreadcrumbs]

[account]
redirect = "login"
paramCode = "code"
forceSecure = 0

[session]
security = "all"

[breadcrumbs]
main-ol-class = "breadcrumb"
active-class = "active"
disabled-class = "disabled"

[resetPassword]
paramCode = "code"
==
<?php
use \Spot\Shipment\Models\Settings;
use RainLab\Translate\Classes\Translator;
use RainLab\Translate\Components\LocalePicker;
protected $translator;
function onStart()
{
    if(!Auth::getUser()){
        \Flash::error($this['theme_lang']['not_allowed']);
        return Redirect::intended('login');
    }

    $this['unreaded']           =   \Zainab\SimpleContact\Models\SimpleContact::where('is_new', 1)->count();

    $this['currentPageUrl']     =   str_replace('/'.$this['currentLang'], '',$this->currentPageUrl());
}
function onQuicksearch()
{
    $data = post();
    $no_results = 0;


    $search     =   $data['query'];

    if(Auth::getUser()->hasUserPermission(["order"],'r')) {
        $orders    =   \Spot\Shipment\Models\Order::orderBy('id', 'DESC')->where(function($q) use($search){
                            $q->where('id', $search);

                            $settings       = \Spot\Shipment\Models\Settings::instance();
                            $length         = strlen($settings['tracking']['prefix_order']);
                            $prefix         = substr($search, 0, $length);
                            if (strcasecmp($prefix, $settings['tracking']['prefix_order']) == 0) {
                                $search =   str_ireplace($settings['tracking']['prefix_order'],'',$search);
                            }
                            $q->orWhere('number', 'like', "%$search%")
                            ->orWhere(function($q) use ($search){
                                $q->whereHas('sender',function($q) use($search){
                                    $q->where('name', 'like', "%$search%")
                                    ->orWhere('username', $search)
                                    ->orWhere('mobile', $search)
                                    ->orWhere('email', $search);
                                });
                            })
                            ->orWhere(function($q) use ($search){
                                $q->whereHas('receiver',function($q) use($search){
                                    $q->where('name', 'like', "%$search%")
                                    ->orWhere('username', $search)
                                    ->orWhere('mobile', $search)
                                    ->orWhere('email', $search);
                                });
                            });
                        });



        switch (Auth::getUser()->role_id) {
            case 6:
                $orders    =   $orders->whereIn('office_id', Auth::getUser()->manage->pluck('id')->toArray());
                break;
            case 5:
                $orders    =   $orders->where(function($q){
                    $q->where('sender_id', Auth::getUser()->id);
                    $q->orWhere('receiver_id', Auth::getUser()->id);
                });
                break;
            case 4:
                if(Auth::getUser()->is_superuser){
                    $orders    =   $orders->whereIn('office_id', Auth::getUser()->office);
                }else{
                    $orders    =   $orders->where(function($q){
                        $q->where(function($q){
                            //Get all employees
                            $q->where('assigned_id', Auth::getUser()->id);
                        });
                        $q->orWhere(function($q){
                            $q->whereHas('manifest', function($q){
                                $q->where(function($q) {
                                    $q->whereIn('driver_id', Auth::getUser()->id);
                                });
                                $q->orWhere(function($q){
                                    $q->whereIn('employee_id', Auth::getUser()->id);
                                });
                            });
                        });
                    });
                }
                break;
            case 3:
                $employees  =   \RainLab\User\Models\User::whereHas('groups',function($q){$q->whereIn('user_group_id', Auth::getUser()->groups->pluck('id')->toArray());})->pluck('id')->toArray();
                $orders    =   $orders->where(function($q) use($employees){
                    $q->where(function($q) use($employees){
                        //Get all employees
                        $q->whereIn('assigned_id', $employees);
                    });
                    $q->orWhere(function($q) use($employees){
                        $q->whereHas('manifest', function($q) use($employees){
                            $q->where(function($q) use($employees){
                                $q->whereIn('driver_id', $employees);
                            });
                            $q->orWhere(function($q) use($employees){
                                $q->whereIn('employee_id', $employees);
                            });
                        });
                    });
                });
                break;
        }

        $orders         =   $orders->get();
    }

    if(Auth::getUser()->hasUserPermission(["client"],'r')) {
        $clients    =   \RainLab\User\Models\User::where('role_id', 5)->orderBy('id', 'DESC')->where(function($q) use($search){
                            $q->orWhere('name', 'like', "%$search%");
                            $q->orWhere('username', 'like', "%$search%");
                            $q->orWhere('mobile', 'like', "%$search%");
                            $q->orWhere('email', 'like', "%$search%");
                        })->get();
    }

    if(!isset($clients) && !isset($orders)){
        $html = '
            <div class="kt-quick-search__result">
             <div class="kt-quick-search__message">
              '.$this['theme_lang']['no_records_found'].'
             </div>
         </div>
        ';
    }else{
        if((isset($clients) && empty($clients->toArray())) && (isset($orders) && empty($orders->toArray()))){
            $html = '
                <div class="kt-quick-search__result">
                 <div class="kt-quick-search__message">
                  '.$this['theme_lang']['no_records_found'].'
                 </div>
             </div>
            ';
        }else{
            $html = '
            <div class="kt-quick-search__result">';
                if(isset($orders)){
                    $html .= '<div class="kt-quick-search__category">
                        '.$this['theme_lang']['orders'].'
                    </div>';
                    $html .= '<div class="kt-quick-search__section">';
                    if(!empty($orders->toArray())){
                            foreach($orders as $order){
                                $html .= '<div class="kt-quick-search__item">
                                    <div class="kt-quick-search__item-img kt-quick-search__item-img--file">
                                        <img src="./admin/media/files/doc.svg" alt="" />
                                    </div>
                                    <div class="kt-quick-search__item-wrapper">
                                        <a href="'.url('dashboard/shipments').'/'.$order->id.'/view" class="kt-quick-search__item-title">
                             '.$this['settings']['tracking']['prefix_order'].$order->number.'
                            </a>
                                        <div class="kt-quick-search__item-desc">
                                            '.$this['theme_lang']['by'].' '.$order->sender->name.'
                                        </div>
                                    </div>
                                </div>';
                            }
                    }else{
                        $html .= '<div class="kt-quick-search__result">
                         <div class="kt-quick-search__message">
                          '.$this['theme_lang']['no_records_found'].'
                         </div>
                     </div>';
                    }
                    $html .= '</div>';
                }

                if(isset($clients)){
                    $html .= '<div class="kt-quick-search__category">
                        '.$this['theme_lang']['users'].'
                    </div>
                    <div class="kt-quick-search__section">';
                        if(!empty($clients->toArray())){
                            foreach($clients as $client){
                                $html .= '<div class="kt-quick-search__item">';
                                if($client->avatar){
                                    $html .= '<div class="kt-quick-search__item-img">
                                        <img src="'.$client->avatar->getThumb(100, 100, ['mode' => 'crop']).'" alt="" />
                                    </div>';
                                }else{
                                    $html .= '<div class="kt-quick-search__item-img">
                                        <!--<span class="kt-header__topbar-icon kt-header__topbar-icon--brand kt-badge--bold">{{user.name|capitalize|slice(0,1)}}</span>-->
                                        <span class="kt-header__topbar-icon kt-header__topbar-icon--brand kt-badge--bold">'.strtoupper(substr($client->name, 0, 2)).'</span>
                                    </div>';
                                }
                                $html .= '<div class="kt-quick-search__item-wrapper">
                                    <a href="'.url('dashboard/clients').'/'.$client->id.'/view" class="kt-quick-search__item-title">
                             '.$client->name.'
                            </a>
                                    <div class="kt-quick-search__item-desc">
                                        '.$client->mobile.'
                                    </div>
                                </div>';
                            }
                        }else{
                            $html .= '<div class="kt-quick-search__result">
                             <div class="kt-quick-search__message">
                              '.$this['theme_lang']['no_records_found'].'
                             </div>
                         </div>';
                        }
                    $html .= '</div>
                    </div>';
                }
            $html .= '</div>';
        }
    }
    return $html;
}
function onRefreshTime(){

}
?>
==
<!DOCTYPE html>
<html lang="{{currentLang}}" {% if currentLang == 'ar'%}direction="rtl" dir="rtl" style="direction: rtl"{% endif %} >

    <head>
    <meta charset="utf-8">
    <base href="{{ 'assets/admin'|theme }}"><!--end::Base Path -->
    <meta charset="{{ settings.company.charset }}">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{{ this.page.title|__ }} | {% if settings.company.title %}{{ settings.company.title|__ }}{% else %}{{ settings.company.title }}{% endif %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
     <meta name="keywords" content="{% if settings.company.keywords %}{{ settings.company.keywords|__ }}{% else %}{{ settings.company.keywords }}{% endif %}" />
     <meta name="description" content="{% if settings.company.description %}{{ settings.company.description|__ }}{% else %}{{ settings.company.description }}{% endif %}">
        <meta name="author" content=""/>

        <link rel="icon" href="{% if settings.favicon %}{{ settings.favicon.path }}{% else %}./admin/media/logos/logo.ico{% endif %}" type="image/png">
        <link rel="apple-touch-icon" href="{% if settings.favicon %}{{ settings.favicon.path }}{% else %}./admin/media/logos/logo.ico{% endif %}"/>
        <link rel="apple-touch-icon" sizes="72x72" href="{% if settings.favicon %}{{ settings.favicon.thumb(72,72) }}{% else %}./admin/media/logos/logo.ico{% endif %}"/>
        <link rel="apple-touch-icon" sizes="114x114" href="{% if settings.favicon %}{{ settings.favicon.thumb(114,114) }}{% else %}./admin/media/logos/logo.ico{% endif %}"/>
        <link rel="apple-touch-icon" sizes="144x144" href="{% if settings.favicon %}{{ settings.favicon.thumb(144,144) }}{% else %}./admin/media/logos/logo.ico{% endif %}"/>


    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <!-- Perfect Scrollbar -->
    <link type="text/css" href="./admin/assets/vendor/perfect-scrollbar.css" rel="stylesheet">

    <!-- App CSS -->
    <link type="text/css" href="./admin/assets/css/app.css" rel="stylesheet">
    <link type="text/css" href="./admin/assets/css/app.rtl.css" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="./admin/assets/css/vendor-material-icons.css" rel="stylesheet">
    <link type="text/css" href="./admin/assets/css/vendor-material-icons.rtl.css" rel="stylesheet">

    <!-- Font Awesome FREE Icons -->
    <link type="text/css" href="./admin/assets/css/vendor-fontawesome-free.css" rel="stylesheet">
    <link type="text/css" href="./admin/assets/css/vendor-fontawesome-free.rtl.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">




</head>


<body class="layout-default">














    <div class="preloader"></div>

    <!-- Header Layout -->
    <div class="mdk-header-layout js-mdk-header-layout">

        <!-- Header -->

        <div id="header" class="mdk-header js-mdk-header m-0" data-fixed>
            <div class="mdk-header__content">

                <div class="navbar navbar-expand-sm navbar-main navbar-dark bg-dark  pr-0" id="navbar" data-primary>
                    <div class="container-fluid p-0">

                        <!-- Navbar toggler -->

                        <button class="navbar-toggler navbar-toggler-right d-block d-md-none" type="button" data-toggle="sidebar">
                            <span class="navbar-toggler-icon"></span>
                        </button>


                        <!-- Navbar Brand -->

                      <a href="{{url('dashboard')}}" class="navbar-brand ">
                       <img alt="Logo" src="{% if settings.logo %}{{ settings.logo.path }}{% else %}./admin/media/logos/logo.svg{% endif %}" style="max-height:50px;"/>
                      </a>



                        <form class="search-form d-none d-sm-flex flex" action="index.html">
                            <button class="btn" type="submit"><i class="material-icons">search</i></button>
                            <input type="text" class="form-control" placeholder="Search">
                        </form>


                        <ul class="nav navbar-nav ml-auto d-none d-md-flex">

                            <li id="notificationsmenu" class="nav-item dropdown">
                                {% partial 'notificationsmenu' %}
                            </li>
                        </ul>

                        <ul class="nav navbar-nav d-none d-sm-flex border-left navbar-height align-items-center">
                            <li class="nav-item dropdown">
                                <a href="#account_menu" class="nav-link dropdown-toggle" data-toggle="dropdown" data-caret="false">
                                    <span class="mr-1 d-flex-inline">
                                        <span class="text-light">{{user.name|capitalize}}</span>
                                    </span>
                                    {% if user.avatar %}
                                         <img alt="Pic" src="{{user.avatar.thumb(25, 25,'crop')}}" />
                                    {% else %}
                                       <span class="kt-badge kt-badge--username kt-badge--unified-brand kt-badge--lg kt-badge--rounded kt-font-light kt-badge--bold">{{user.name|upper|slice(0,2)}}</span>
                                    {% endif %}
                                    <!-- <img src="assets/images/avatar/demi.png" class="rounded-circle" width="32" alt="Frontted"> -->
                                </a>
                                <div id="account_menu" class="dropdown-menu dropdown-menu-right">
                                    <div class="dropdown-item-text dropdown-item-text--lh">
                                        <div><strong>{{user.name|capitalize}}</strong></div>
                                        <div class="text-muted">@{{user.username|capitalize}}</div>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="{{url('dashboard')}}"><i class="material-icons">dvr</i> Dashboard</a>
                                    <a class="dropdown-item" href="{{'dashboard/profile'|page}}"><i class="material-icons">account_circle</i> {{'My Profile'|__}}</a>
                                    <a class="dropdown-item" href="{{'dashboard/notifications'|page}}"><i class="material-icons">edit</i> {{'My Notifications'|__}}</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" data-request="onLogout" data-request-data="redirect: '/'"><i class="material-icons">exit_to_app</i> {{'Sign Out'|__}}</a>
                                </div>
                            </li>
                        </ul>

                    </div>
                </div>

            </div>
        </div>

        <!-- // END Header -->

        <!-- Header Layout Content -->
        <div class="mdk-header-layout__content">

            <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
                <div class="mdk-drawer-layout__content page">




                    <div class="container-fluid page__heading-container">
                        <div class="page__heading d-flex align-items-center">
                            <div class="flex">
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb mb-0">
                                        <li class="breadcrumb-item"><a href="{{url('dashboard')}}"><i class="material-icons icon-20pt">home</i></a></li>
                                        <li class="breadcrumb-item active" aria-current="page">{{ this.page.title|__ }}</li>
                                    </ol>
                                </nav>
                                <h1 class="m-0">{{ this.page.title|__ }}</h1>
                            </div>
                            <a href="href="{{'dashboard/order-create'|page}}"" class="btn btn-success ml-3"><span>{{'Add Shipment'|__}}</span> <i class="material-icons">add</i></a>
                        </div>
                    </div>








                    <div class="container-fluid page__container">
                        

                        {% page %}
                        <div class="row">
                            
                            
                        </div>

                    </div>


                </div>
                <!-- // END drawer-layout__content -->

                <div class="mdk-drawer  js-mdk-drawer" id="default-drawer" data-align="start">
                    <div class="mdk-drawer__content">
                        <div class="sidebar sidebar-light sidebar-left sidebar-p-t" data-perfect-scrollbar>
                            <div class="sidebar-heading">Menu</div>
                            {% if mainMenu.menuItems %}
                            <ul class="sidebar-menu">
                                 {% for item in mainMenu.menuItems if not item.viewBag.isHidden %}
                                        {% if user.hasUserPermission(item.code, 'r') or item.code is empty %}
                                            <li class="sidebar-menu-item {{ item.isActive or item.isChildActive or this.page.menu_breadcrumb == item.code ? 'active open' : '' }}">
                                                <a class="sidebar-menu-button" {% if item.items %} data-toggle="collapse" href="#{{ item.title|__ }}"{%else%} {% if item.url %}href="{{ item.url }}"{% endif %} {% endif %}  >
                                                    <span class="sidebar-menu-icon sidebar-menu-icon--left material-icons">
                                                        {{ item.viewBag.icon|raw }}
                                                    </span>
                                                    <!-- <i class="sidebar-menu-icon sidebar-menu-icon--left material-icons">dvr</i> -->
                                                    <span class="sidebar-menu-text">{{ item.title|__ }}</span>
                                                    {% if item.items %}
                                                    <span class="ml-auto sidebar-menu-toggle-icon"></span>
                                                    {% endif %}
                                                </a>
                                                {% if item.items %}
                                                <ul class="sidebar-submenu collapse  " id="{{ item.title|__ }}">
                                                    {% for item in item.items if not item.viewBag.isHidden %}
                                                        {% if user.hasUserPermission(item.code, 'r') or item.code is empty %}
                                                    <li class="sidebar-menu-item">
                                                        <a class="sidebar-menu-button" href="{% if item.url %}{{ item.url|replace({'[url]': url('/')}) }}{% else %}javascript:;{% endif %}">
                                                            <span class="sidebar-menu-text">{{ item.title|__ }}</span>
                                                        </a>
                                                    </li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                {% endfor %}
                               <!--  <li class="sidebar-menu-item active open">
                                    <a class="sidebar-menu-button" data-toggle="collapse" href="#dashboards_menu">
                                        <i class="sidebar-menu-icon sidebar-menu-icon--left material-icons">dvr</i>
                                        <span class="sidebar-menu-text">Dashboards</span>
                                        <span class="ml-auto sidebar-menu-toggle-icon"></span>
                                    </a>
                                    <ul class="sidebar-submenu collapse show " id="dashboards_menu">
                                        <li class="sidebar-menu-item">
                                            <a class="sidebar-menu-button" href="index.html">
                                                <span class="sidebar-menu-text">Default</span>
                                            </a>
                                        </li>
                                        <li class="sidebar-menu-item">
                                            <a class="sidebar-menu-button" href="analytics.html">
                                                <span class="sidebar-menu-text">Analytics</span>
                                            </a>
                                        </li>
                                        <li class="sidebar-menu-item">
                                            <a class="sidebar-menu-button" href="staff.html">
                                                <span class="sidebar-menu-text">Staff</span>
                                            </a>
                                        </li>
                                        <li class="sidebar-menu-item">
                                            <a class="sidebar-menu-button" href="ecommerce.html">
                                                <span class="sidebar-menu-text">E-commerce</span>
                                            </a>
                                        </li>
                                        <li class="sidebar-menu-item active">
                                            <a class="sidebar-menu-button" href="dashboard-quick-access.html">
                                                <span class="sidebar-menu-text">Quick Access</span>
                                            </a>
                                        </li>
                                    </ul>
                                </li> -->

                            </ul>
                            {% endif %}
                          <!--   <div class="sidebar-block p-0 mb-0">
                                <div class="sidebar-p-a sidebar-b-y">
                                    <div class="d-flex align-items-top mb-2">
                                        <div class="sidebar-heading m-0 p-0 flex text-body js-text-body">Progress</div>
                                        <div class="font-weight-bold text-success">60%</div>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center sidebar-p-a border-bottom sidebar-account">
                                <a href="profile.html" class="flex d-flex align-items-center text-underline-0 text-body">
                                    <span class="avatar avatar-sm mr-2">
                                        <img src="assets/images/avatar/demi.png" alt="avatar" class="avatar-img rounded-circle">
                                    </span>
                                    <span class="flex d-flex flex-column">
                                        <strong>Adrian Demian</strong>
                                        <small class="text-muted text-uppercase">Site Manager</small>
                                    </span>
                                </a>
                                <div class="dropdown ml-auto">
                                    <a href="#" data-toggle="dropdown" data-caret="false" class="text-muted"><i class="material-icons">more_vert</i></a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <div class="dropdown-item-text dropdown-item-text--lh">
                                            <div><strong>Adrian Demian</strong></div>
                                            <div>@adriandemian</div>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="index.html">Dashboard</a>
                                        <a class="dropdown-item" href="profile.html">My profile</a>
                                        <a class="dropdown-item" href="edit-account.html">Edit account</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="login.html">Logout</a>
                                    </div>
                                </div>
                            </div> -->

                            <!-- <div class="sidebar-p-a">
                                <a href="https://themeforest.net/item/stack-admin-bootstrap-4-dashboard-template/22959011" class="btn btn-primary btn-block">Purchase &dollar;35</a>
                            </div> -->

                        </div>
                    </div>
                </div>
            </div>
            <!-- // END drawer-layout -->

        </div>
        <!-- // END header-layout__content -->

    </div>
    <!-- // END header-layout -->

    <!-- App Settings FAB -->
    <div id="app-settings">
        <app-settings layout-active="default" :layout-location="{
      'default': 'dashboard-quick-access.html',
      'fixed': 'fixed-dashboard-quick-access.html',
      'fluid': 'fluid-dashboard-quick-access.html',
      'mini': 'mini-dashboard-quick-access.html'
    }"></app-settings>
    </div>

    <!-- jQuery -->
    <script src="./admin/assets/vendor/jquery.min.js"></script>
     

    <!-- Bootstrap -->
    <script src="./admin/assets/vendor/popper.min.js"></script>
    <script src="./admin/assets/vendor/bootstrap.min.js"></script>

    <!-- Perfect Scrollbar -->
    <script src="./admin/assets/vendor/perfect-scrollbar.min.js"></script>

    <!-- DOM Factory -->
    <script src="./admin/assets/vendor/dom-factory.js"></script>

    <!-- MDK -->
    <script src="./admin/assets/vendor/material-design-kit.js"></script>

    <!-- App -->
    <script src="./admin/assets/js/toggle-check-all.js"></script>
    <script src="./admin/assets/js/check-selected-row.js"></script>
    <script src="./admin/assets/js/dropdown.js"></script>
    <script src="./admin/assets/js/sidebar-mini.js"></script>
    <script src="./admin/assets/js/app.js"></script>

    <!-- App Settings (safe to remove) -->
    <script src="./admin/assets/js/app-settings.js"></script>




    <script>
        (function() {
            'use strict';

            // ENABLE sidebar menu tabs
            $('#sidebar-mini-tabs [data-toggle="tab"]').on('click', function(e) {
                e.preventDefault()
                $(this).tab('show')
            })
        })()
    </script>

        <!-- begin::Global Config(global config for global JS sciprts) -->
        <script>
            {% set timezone = settings.timezone_offset|split(':') %}
            {% set timezone_offset = (timezone.0*60) + (timezone.1) %}
            {% set timezone_offset_hours = (timezone_offset/60) %}

            var KTAppOptions = {
                "colors":{
                    "state":{
                        "brand":"#5d78ff",
                        "light":"#ffffff",
                        "dark":"#282a3c",
                        "primary":"#5867dd",
                        "success":"#34bfa3",
                        "info":"#36a3f7",
                        "warning":"#ffb822",
                        "danger":"#fd3995"
                    },
                    "base":{
                        "label":[
                            "#c5cbe3",
                            "#a1a8c3",
                            "#3d4465",
                            "#3e4466"
                        ],
                        "shape":[
                            "#f0f3ff",
                            "#d9dffa",
                            "#afb4d4",
                            "#646c9a"
                        ]
                    }
                },
                "text":{
                    'loading' : '{{"Loading ..."|__}}'
                },
                "timezone_offset": "{{timezone_offset}}",
                "timezone_offset_hours": "{{timezone_offset_hours}}",
                "dateformat": "{{settings.dateformat|replace({'d':'dd', 'm':'mm', 'Y':'yyyy'})}}",
                "daterangeformat": "{{settings.dateformat|replace({'d':'DD', 'm':'MM', 'M':'MMM'})}}"
            };
        </script>
        <!-- end::Global Config -->

     <!--begin::Global Theme Bundle(used by all pages) -->
            <script src="./admin/vendors/custom/notifications/js/modernizr.custom.js" type="text/javascript"></script>
            <script src="./admin/vendors/custom/notifications/js/classie.js" type="text/javascript"></script>
            <script src="./admin/vendors/custom/notifications/js/notificationFx.js" type="text/javascript"></script>
        <script src="./admin/vendors/global/vendors.bundle.js" type="text/javascript"></script>
        <script src="./admin/js/demo1/scripts.bundle.js" type="text/javascript"></script>
           {% if settings.notifications.live == 1 %}
               <script src="//js.pusher.com/5.0/pusher.min.js"></script>
           {% endif %}
  <!--end::Global Theme Bundle -->

        <!--begin::Page Scripts(used by this page) -->
            {% framework extras %}
            {% scripts %}
            <script type="text/javascript">
                function flashRequest(type,message){

                    swal.fire({
                        buttonsStyling: false,
                        title: message,
                        type: type,
                        showConfirmButton: false,
                        timer: 3000
                    });
                }
                KTUtil.ready(function () {

                    $.validator.addMethod("customDateValidator", function(value, element) {
                            // parseDate throws exception if the value is invalid
                            try{$.datepicker.parseDate( KTAppOptions.dateformat, value);return true;}
                            catch(e){return false;}
                        },
                        "{{'Please enter a valid date'|__}}"
                    );

                    if('dd/mm/yyyy' == KTAppOptions.dateformat){
                        console.log(KTAppOptions.dateformat);
                        $.validator.methods.date = function (value, element) {
                            value = dateValue(value);
                            return this.optional(element) || !/Invalid|NaN/.test(new Date(value).toString());;
                        }

                        function dateValue(value) {
                            var date = value.split("/");
                            return date[2] + "/" + date[1] + "/" + date[0]
                        }
                    }

                    $('body').on('click', '.locale', function(e){
                        e.preventDefault();
                        var selected = $(this).attr('rel');
                        if(selected != ''){
                            $.request('onSwitchLocale', {
                                data: {locale: selected}
                            });
                        }
                    });
                    $('select').selectpicker({
                        noneSelectedText: '{{"Nothing selected"|__}}',
                    });
                    if (KTUtil.get('kt_quick_search_dropdown')) {
                        KTQuickSearch().init(KTUtil.get('kt_quick_search_dropdown'));
                    }

                    if (KTUtil.get('kt_quick_search_inline')) {
                        KTQuickSearchInline().init(KTUtil.get('kt_quick_search_inline'));
                    }

                    if (KTUtil.get('kt_quick_search_offcanvas')) {
                        KTQuickSearchOffcanvas().init(KTUtil.get('kt_quick_search_offcanvas'));
                    }

                    $('input.decimal').blur(function(){
                        var num = parseFloat($(this).val());
                        var cleanNum = num.toFixed({{primary_currency.initbiz_money_fraction_digits}});
                        $(this).val(cleanNum);
                    });

                    var arrows;
                    if (KTUtil.isRTL()) {
                        arrows = {
                            leftArrow: '<i class="la la-angle-right"></i>',
                            rightArrow: '<i class="la la-angle-left"></i>'
                        }
                    } else {
                        arrows = {
                            leftArrow: '<i class="la la-angle-left"></i>',
                            rightArrow: '<i class="la la-angle-right"></i>'
                        }
                    }

                    $.fn.datepicker.dates['{{currentLang}}'] = {
                        days: ["{{'Sunday'|__}}", "{{'Monday'|__}}", "{{'Tuesday'|__}}", "{{'Wednesday'|__}}", "{{'Thursday'|__}}", "{{'Friday'|__}}", "{{'Saturday'|__}}"],
                        daysShort: ["{{'Sun'|__}}", "{{'Mon'|__}}", "{{'Tue'|__}}", "{{'Wed'|__}}", "{{'Thu'|__}}", "{{'Fri'|__}}", "{{'Sat'|__}}"],
                        daysMin: ["{{'Su'|__}}", "{{'Mo'|__}}", "{{'Tu'|__}}", "{{'We'|__}}", "{{'Th'|__}}", "{{'Fr'|__}}", "{{'Sa'|__}}"],
                        months: ["{{'January'|__}}", "{{'February'|__}}", "{{'March'|__}}", "{{'April'|__}}", "{{'May'|__}}", "{{'June'|__}}", "{{'July'|__}}", "{{'August'|__}}", "{{'September'|__}}", "{{'October'|__}}", "{{'November'|__}}", "{{'December'|__}}"],
                        monthsShort: ["{{'Jan'|__}}", "{{'Feb'|__}}", "{{'Mar'|__}}", "{{'Apr'|__}}", "{{'May'|__}}", "{{'Jun'|__}}", "{{'Jul'|__}}", "{{'Aug'|__}}", "{{'Sep'|__}}", "{{'Oct'|__}}", "{{'Nov'|__}}", "{{'Dec'|__}}"],
                        today: "{{'Today'|__}}",
                        clear: "{{'Clear'|__}}",
                        format: KTAppOptions.dateformat,
                        titleFormat: KTAppOptions.dateformat, /* Leverages same syntax as 'format' */
                        weekStart: 0
                    };
                    $('.date').datepicker({
                        rtl: KTUtil.isRTL(),
                        language: '{{currentLang}}',
                        format: KTAppOptions.dateformat,
                        todayHighlight: true,
                        orientation: "bottom left",
                        templates: arrows
                    });

                        var momentNow = moment();

                    console.log({{timezone_offset}});
                    console.log({{timezone_offset_hours}});
                    console.log(momentNow.utcOffset(4));
                    console.log(momentNow.utcOffset({{timezone_offset_hours}}));
                    var interval = setInterval(function() {
                        if('ar' == '{{currentLang}}'){
                            moment.locale('ar-sa');
                        }
                        var momentNow = moment();
                        $('#date-part').html(momentNow.utcOffset({{timezone_offset_hours}}).format(KTAppOptions.daterangeformat) + ' ');
                        $('#time-part').html(momentNow.utcOffset({{timezone_offset_hours}}).format('hh:mm:ss A'));
                    }, 100);

                });

                "use strict";

                var KTQuickSearch = function() {
                    var target;
                    var form;
                    var input;
                    var closeIcon;
                    var resultWrapper;
                    var resultDropdown;
                    var resultDropdownToggle;
                    var inputGroup;
                    var query = '';

                    var hasResult = false;
                    var timeout = false;
                    var isProcessing = false;
                    var requestTimeout = 200; // ajax request fire timeout in milliseconds
                    var spinnerClass = 'kt-spinner kt-spinner--input kt-spinner--sm kt-spinner--brand kt-spinner--right';
                    var resultClass = 'kt-quick-search--has-result';
                    var minLength = 2;

                    var showProgress = function() {
                        isProcessing = true;
                        KTUtil.addClass(inputGroup, spinnerClass);

                        if (closeIcon) {
                            KTUtil.hide(closeIcon);
                        }
                    }

                    var hideProgress = function() {
                        isProcessing = false;
                        KTUtil.removeClass(inputGroup, spinnerClass);

                        if (closeIcon) {
                            if (input.value.length < minLength) {
                                KTUtil.hide(closeIcon);
                            } else {
                                KTUtil.show(closeIcon, 'flex');
                            }
                        }
                    }

                    var showDropdown = function() {
                        if (resultDropdownToggle && !KTUtil.hasClass(resultDropdown, 'show')) {
                            $(resultDropdownToggle).dropdown('toggle');
                            $(resultDropdownToggle).dropdown('update');
                        }
                    }

                    var hideDropdown = function() {
                        if (resultDropdownToggle && KTUtil.hasClass(resultDropdown, 'show')) {
                            $(resultDropdownToggle).dropdown('toggle');
                        }
                    }

                    var processSearch = function() {
                        if (hasResult && query === input.value) {
                            hideProgress();
                            KTUtil.addClass(target, resultClass);
                            showDropdown();
                            KTUtil.scrollUpdate(resultWrapper);

                            return;
                        }

                        query = input.value;

                        KTUtil.removeClass(target, resultClass);
                        showProgress();
                        hideDropdown();

                        $.request('onQuicksearch', {
                            data: {query: query},
                            success: function(res) {
                                hasResult = true;
                                hideProgress();
                                KTUtil.addClass(target, resultClass);
                                KTUtil.setHTML(resultWrapper, res.result);
                                showDropdown();
                                KTUtil.scrollUpdate(resultWrapper);
                            },
                            error: function(res) {
                                hasResult = false;
                                hideProgress();
                                KTUtil.addClass(target, resultClass);
                                KTUtil.setHTML(resultWrapper, '<span class="kt-quick-search__message kt-font-danger">{{"Connection error. Pleae try again later"|__}}.</div>');
                                showDropdown();
                                KTUtil.scrollUpdate(resultWrapper);
                            }
                        });
                    }

                    var handleCancel = function(e) {
                        input.value = '';
                        query = '';
                        hasResult = false;
                        KTUtil.hide(closeIcon);
                        KTUtil.removeClass(target, resultClass);
                        hideDropdown();
                    }

                    var handleSearch = function() {
                        if (input.value.length < minLength) {
                            hideProgress();
                            hideDropdown();

                            return;
                        }

                        if (isProcessing == true) {
                            return;
                        }

                        if (timeout) {
                            clearTimeout(timeout);
                        }

                        timeout = setTimeout(function() {
                            processSearch();
                        }, requestTimeout);
                    }

                    return {
                        init: function(element) {
                            // Init
                            target = element;
                            form = KTUtil.find(target, '.kt-quick-search__form');
                            input = KTUtil.find(target, '.kt-quick-search__input');
                            closeIcon = KTUtil.find(target, '.kt-quick-search__close');
                            resultWrapper = KTUtil.find(target, '.kt-quick-search__wrapper');
                            resultDropdown = KTUtil.find(target, '.dropdown-menu');
                            resultDropdownToggle = KTUtil.find(target, '[data-toggle="dropdown"]');
                            inputGroup = KTUtil.find(target, '.input-group');

                            // Attach input keyup handler
                            KTUtil.addEvent(input, 'keyup', handleSearch);
                            KTUtil.addEvent(input, 'focus', handleSearch);

                            // Prevent enter click
                            form.onkeypress = function(e) {
                                var key = e.charCode || e.keyCode || 0;
                                if (key == 13) {
                                    e.preventDefault();
                                }
                            }

                            KTUtil.addEvent(closeIcon, 'click', handleCancel);
                        }
                    };
                };

                var KTQuickSearchInline = KTQuickSearch;
                var KTQuickSearchOffcanvas = KTQuickSearch;
                {% if settings.notifications.live == 1 %}
                    var pusher = new Pusher('{{ settings.notifications.pusher.key }}', {cluster: '{{ settings.notifications.pusher.cluster }}',forceTLS: true});
                    var presenceChannel = pusher.subscribe('spotlayer');
                    presenceChannel.bind('notification', function(data) {
                        //if(data.id != {{user.id}}){
                        if(data.for_userid == {{user.id}}){
                            setTimeout( function() {
                                // create the notification
                                // check if the reciever is the targeted user
                                if(data.thumb == 'icon'){
                                    var thumb_content = '<i class="'+data.icon+'"></i>';
                                }else{
                                    var thumb_content = '<img src="./admin/vendors/custom/notifications/img/default.jpg"/>';
                                }
                                var notification = new NotificationFx({
                                    message : '<div class="ns-thumb '+data.thumb+'">'+thumb_content+'</div><div class="ns-content notice"><p><a href="{{url('dashboard/notifications')}}">'+data.sender.name+'</a> '+data.subject+'.</p></div>',
                                    layout : 'other',
                                    ttl : 5000,
                                    effect : 'thumbslider',
                                    type : 'notice', // notice, warning, error or success
                                    onClose : function() {
                                        //dismiss notification and make it as readed;
                                    }
                                });
                                // show the notification
                                notification.show();
                                if(data.sound){
                                    let audio = new Audio('./admin/media/notifications/notification.mp3');
                                    audio.play();
                                }
                                $.request('onRefreshTime', {
                                    data: {id: {{user.id}}},
                                    update: { notificationsmenu: '#notificationsmenu' },
                                    complete: function(e) {
                                        notificationPanel();
                                    }
                                });
                            }, 4000 );
                        }


                    });
                {% endif %}
            </script>
        <!--end::Page Scripts -->


</body>
</html>
